{
  "paper_id": "2006.15955v1",
  "title": "A Transformer-Based Joint-Encoding For Emotion Recognition And Sentiment Analysis",
  "published": "2020-06-29T11:51:46Z",
  "authors": [
    "Jean-Benoit Delbrouck",
    "Noé Tits",
    "Mathilde Brousmiche",
    "Stéphane Dupont"
  ],
  "keywords": [],
  "sections": [
    {
      "section_name": "Abstract",
      "text": "Understanding expressed sentiment and emotions are two crucial factors in human multimodal language. This paper describes a Transformer-based joint-encoding (TBJE) for the task of Emotion Recognition and Sentiment Analysis. In addition to use the Transformer architecture, our approach relies on a modular co-attention and a glimpse layer to jointly encode one or more modalities. The proposed solution has also been submitted to the ACL20: Second Grand-Challenge on Multimodal Language to be evaluated on the CMU-MOSEI dataset. The code to replicate the presented experiments is open-source 1 .",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Introduction",
      "text": "Predicting affective states from multimedia is a challenging task. Emotion recognition task has existed working on different types of signals, typically audio, video and text. Deep Learning techniques allow the development of novel paradigms to use these different signals in one model to leverage joint information extraction from different sources. This paper aims to bring a solution based on ideas taken from Machine Translation  (Transformers, Vaswani et al. (2017) ) and Visual Question Answering (Modular co-attention,  Yu et al. (2019) ). Our contribution is not only very computationally efficient, it is also a viable solution for Sentiment Analysis and Emotion Recognition. Our results can compare with, and sometimes surpass, the current state-of-the-art for both tasks on the CMU-MOSEI dataset  (Zadeh et al., 2018b) . This paper is structured as follows: first, in section 2, we quickly go over the related work that have been evaluated on the MOSEI dataset, we 1 https://github.com/jbdel/MOSEI_UMONS then proceed to describe our model in Section 3, we then explain how we extract our modality features from raw videos in Section 4 and finally, we present the dataset used for our experiments and their respective results in section 5 and 6.",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Related Work",
      "text": "Over the years, many creative solutions have been proposed by the research community in the field of Sentiment Analysis and Emotion Recognition. In this section, we proceed to describe different models that have been evaluated on the CMU-MOSEI dataset. To the best of our knowledge, none of these ideas uses a Tansformer-based solution.\n\nThe Memory Fusion Network (MFN,  Zadeh et al. (2018a) ) synchronizes multimodal sequences using a multi-view gated memory that stores intraview and cross-view interactions through time.\n\nGraph-MFN  (Zadeh et al., 2018b)  consists of a Dynamic Fusion Graph (DFG) built upon MFN. DFG is a fusion technique that tackles the nature of cross-modal dynamics in multimodal language. The fusion is a network that learns to models the n-modal interactions and can dynamically alter its structure to choose the proper fusion graph based on the importance of each n-modal dynamics during inference.  Sahay et al. (2018)  use Tensor Fusion Network (TFN), i.e. an outer product of the modalities. This operation can be performed either on a whole sequence or frame by frame. The first one lead to an exponential increase of the feature space when modalities are added that is computationally ex-pensive. The second approach was thus preferred. They showed an improvement over an early fusion baseline.\n\nRecently,  Shenoy and Sardana (2020)  propose a solution based on a context-aware RNN, Multilogue-Net, for Multi-modal Emotion Detection and Sentiment Analysis in conversation.",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Model",
      "text": "This section aims to describe the two model variants evaluated in our experiment: a monomodal variant and a multimodal variant. The monomodal variant is used to classify emotions and sentiments based solely on L (Linguistic), on V (Visual) or on A (Acoustic). The multimodal version is used for any combination of modalities.\n\nOur model is based on the Transformer model  (Vaswani et al., 2017) , a new encoding architecture that fully eschews recurrence for sequence encoding and instead relies entirely on an attention mechanism and Feed-Forward Neural Networks (FFN) to draw global dependencies between input and output. The Transformer allows for significantly more parallelization compared to the Recurrent Neural Network (RNN) that generates a sequence of hidden states h t , as a function of the previous hidden state h t-1 and the input for position t.",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Monomodal Transformer Encoding",
      "text": "The monomodal encoder is composed of a stack of B identical blocks but with their own set of training parameters. Each block has two sub-layers. There is a residual connection around each of the two sublayers, followed by layer normalization  (Ba et al., 2016) . The output of each sub-layer can be written like this:\n\nwhere Sublayer(x) is the function implemented by the sub-layer itself. In traditional Transformers, the two sub-layers are respectively a multi-head self-attention mechanism and a simple Multi-Layer Perceptron (MLP).\n\nThe attention mechanism consists of a Key K and Query Q that interacts together to output a attention map applied to Context C:\n\nIn the case of self-attention, K, Q and C are the same input. If this input is of size N × k, the operation QK results in a squared attention matrix containing the affinity between each row N . Expression √ k is a scaling factor. The multi-head attention (MHA) is the idea of stacking several selfattention attending the information from different representation sub-spaces at different positions:\n\n(3) A subspace is defined as slice of the feature dimension k. In the case of four heads, a slice would be of size k 4 . The idea is to produce different sets of attention weights for different feature sub-spaces. After encoding through the blocks, output x can be used by a projection layer for classification. In",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Multimodal Transformer Encoding",
      "text": "The idea of a multimodal transformer consists in adding a dedicated transformer (section 3.1) for each modality we work with. While our contribution follows this procedure, we also propose three ideas to enhance it: a joint-encoding, a modular co-attention  (Yu et al., 2019)  and a glimpse layer at the end of each block.\n\nThe modular co-attention consists of modulating the self-attention of a modality, let's call it y, by a primary modality x. To do so, we switch the key K and context C of the self-attention from y to\n\nx. The operation QK results in an attention map that acts like an affinity matrix between the rows of modality matrix x and y. This computed alignment is applied over the context C (now x) and finally we add the residual connection y. The following equation describes the new attention sub-layer:\n\nIn this scenario, for the operation QK to work as well as the residual connection (the addition), the feature sizes of x and y must be equal. This can be adjusted with the different transformation matrices of the MHA module. Because the encoding is joint, each modality is encoded at the same time (i.e. we don't unroll the encoding blocks for one modality before moving on to another modality). This way, the MHA attention of modality y for block b is done by the representation of x at block b.\n\nFinally, we add a last layer at the end of each modality block, called the glimpse layer, where the modality is projected in a new space of representation. A glimpse layer consists of stacking G soft attention layers and stacking their outputs. Each soft attention is seen as a glimpse. Formally, we define the soft attention (SoA) i with input matrix M ∈ R N ×k by a MLP and a weighted sum:\n\nwhere W m if a transformation matrix of size 2k×k, v a i is of size 1 × 2k and m i a vector of size k. Then we can define the glimpse mechanism for matrix M of glimpse size G m as the stacking of all glimpses:\n\nNote that before the parameter W m , whose role is to embed the matrix M in a higher dimension, is shared between all glimpses (this operation is therefore only computed once) while the set of vectors {v a i } computing the attention weights from this bigger space is dedicated for each glimpse. In our contribution, we always chose G m = N so the sizes allow us to perform a final residual connections M = LayerNorm(M + G M ). The Figure  2  depicts the encoding for two features where modality x is modulating the modality y. This encoding can be ported to any number of modalities by duplicating the architecture. In our case, it is always the linguistic modality that modulates the others.",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Classification Layer",
      "text": "After all the Transformer blocks were computed, a modality goes into a final glimpse layer of size 1. The result is therefore only one vector. The vectors of each modality are summed element-wise, let's call the results of this sum s, and are then projected over possible answers according to the following equation:\n\nIf there is only one modality, the sum operation is omitted.",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Feature Extractions",
      "text": "This section aims to explain how we pre-compute the features for each modality. These features are the inputs of the Transformer blocks. Note that the features extraction is done independently for each example of the dataset.",
      "page_start": 1,
      "page_end": 1
    },
    {
      "section_name": "Linguistic",
      "text": "Each utterance is tokenized and lowercase. We also remove special characters and punctuation. We build our vocabulary against the train-set and end up with a glossary of 14.176 unique words. We embed each word in a vector of 300 dimensions using GloVe  (Pennington et al., 2014) . If a word from the validation or test-set is not in present our vocabulary, we replace it with the unknown token \"unk\".",
      "page_start": 3,
      "page_end": 3
    },
    {
      "section_name": "Acoustic",
      "text": "The acoustic part of the signal of the video contains a lot of speech. Speech is used in conversations to communicate information with words but also contains a lot of information that are non linguistic such as nonverbal expressions (laughs, breaths, sighs) and prosody features (intonation, speaking rate). These are important data in an emotion recognition task.\n\nAcoustic features widely used in the speech processing field such as F0, formants, MFCCs, spectral slopes consist of handcrafted sets of high-level features that are useful when an interpretation is needed, but generally discard a lot of information. Instead, we decide to use low-level features for speech recognition and synthesis, the mel-spectrograms. Since the breakthrough of deep learning systems, the mel-spectrograms have become a suitable choice.\n\nThe spectrum of a signal is obtained with Fourier analysis that decompose a signal in a sum of sinusoids. The amplitudes of the sinusoids constitute the amplitude spectrum. A spectrogram is the concatenation over time of spectra of windows of the signal. Mel-spectrogram is a compressed version of spectrograms, using the fact the human ear is more sensitive to low frequencies than high frequencies. This representation thus attributes more resolution for low frequencies than high frequencies using mel filter banks. A mel-spectrogram is typically used as an intermediate step for text-to-speech synthesis  (Tachibana et al., 2018)  in state-of-the-art systems as audio representation, so we believe it is a good compromise between dimensionality and representation capacity.\n\nOur mel-spectrograms were extracted with the same procedure as in  (Tachibana et al., 2018)  with librosa  (McFee et al., 2015)  library with 80 filter banks (the embedding size is therefore 80). A tem-poral reduction by selecting one frame every 16 frames was the applied.",
      "page_start": 4,
      "page_end": 5
    },
    {
      "section_name": "Visual",
      "text": "Inspired by the success of convolutional neural networks (CNNs) in different tasks, we chose to extract visual features with a pre-trained CNN. Current models for video classification use CNNs with 3D convolutional kernels to process the temporal information of the video together with spatial information  (Tran et al., 2015) . The 3D CNNs learn spatio-temporal features but are much more expensive than 2D CNNs and prone to overfitting. To reduce complexity,  Tran et al. (2018)  explicitly factorizes 3D convolution into two separate and successive operations, a 2D spatial convolution and a 1D temporal convolution. We chose this model, named R(2+1)D-152, to extract video features for the emotion recognition task. The model is pretrained on Sports-1M and Kinetics.\n\nThe model takes as input a clip of 32 RGB frames of the video. Each frame is scaled to the size of 128 x 171 and then cropped a window of size 112 x 112. The features are extracted by taking the output of the spatiotemporal pooling. The feature vector for the entire video is obtained by sliding a window of 32 RGB frames with a stride of 8 frames.\n\nWe chose not to crop out the face region of the video and keep the entire image as input to the network. Indeed, the video is already centered on the person and we expect that the movement of the body such as the hands can be a good indicator for the emotion recognition and sentiment analysis tasks.",
      "page_start": 6,
      "page_end": 6
    },
    {
      "section_name": "Dataset",
      "text": "We test our joint-encoding solution on a novel dataset for multimodal sentiment and emotion recognition called CMU-Multimodal Opinion Sentiment and Emotion Intensity (CMU-MOSEI,  Zadeh et al. (2018b) ). It consists of 23,453 annotated sentences from 1000 distinct speakers. Each sentence is annotated for sentiment on a [-3,3] scale from highly negative (-3) to highly positive (+3) and for emotion by 6 classes : happiness, sadness, anger, fear, disgust, surprise. In the scope of our experiment, the emotions are   1 : Results on the test-set. Note that the F1-scores for emotions are weighted to be consistent with the previous state-of-the-art. Also, we do not compare accuracies for emotions, as previous works use a weighted variant while we use standard accuracy. G-MFN is the Graph-MFN model and Mu-Net is the Multilogue-Net model.\n\neither present or not present (binary classification), but two emotions can be present at the same time, making it a multi-label problem.",
      "page_start": 7,
      "page_end": 7
    },
    {
      "section_name": "Experiments",
      "text": "In this section, we report the results of our model variants described in Section 3. We first explain our experimental setting.",
      "page_start": 5,
      "page_end": 5
    },
    {
      "section_name": "Experimental Settings",
      "text": "We train our models using the Adam optimizer (Kingma and Ba, 2014) with a learning rate of 1e -4 and a mini-batch size of 32. If the accuracy score on the validation set does not increase for a given epoch, we apply a learning-rate decay of factor 0.2. We decay our learning rate up to 2 times. Afterwards, we use an early-stop of 3 epochs. Results presented in this paper are from the averaged predictions of 5 models.\n\nUnless stated otherwise, we use 6 Transformer blocks of hidden-size 512, regardless of the modality encoded. The self-attention has 4 multi-heads and the MLP has one hidden layer of 1024. We apply dropout of 0.1 on the output of each block (equation 4) and of 0.5 on the input of the classification layer (s in equation 6). For the acoustic and visual features, we truncate the features for spatial dimensions above 40. We also use that number for the number of glimpses. This choice is made base on Figure  4  6",
      "page_start": 6,
      "page_end": 6
    },
    {
      "section_name": ".2 Results",
      "text": "The Table  1  show the scores of our different modality combinations. We do not compare accuracies for emotions with previous works as they used a weighted accuracy variant while we use standard accuracy.\n\nWe notice that our L+A (linguistic + acoustic) is the best model. Unfortunately, adding the visual input did not increase the results, showing that it is still the most difficult modality to integrate into a multimodal pipeline. For the sentiment task, the improvement is more tangible for the 7-class, showing that our L+A model learns better representations for more complex classification problems compared to our monomodal model L using only the linguistic input. We also surpass the previous state-of-the-art for this task. For the emotions, we can see that Multilogue-Net gives better prediction for some classes, such as happy, sad, angry and disgust. We postulate that this is because Multilogue is a context-aware method while our model does not take into account the previous or next sentence to predict the current utterance. This might affect our accuracy and f1-score on the emotion task.\n\nThe following Table  2  depicts the results of our solution sent to the Second Grand-Challenge on Multimodal Language. It has been evaluated on the private test-fold released for the challenge and can serve as a baseline for future research. Note that in this table, the F1-scores are unweighted, as should be future results for a fair comparison and interpretation of the results.",
      "page_start": 7,
      "page_end": 7
    },
    {
      "section_name": "Discussions",
      "text": "We presented a computationally efficient and robust model for Sentiment Analysis and Emotion Recognition evaluated on CMU-MOSEI. Though we showed strong results on accuracy, we can see that there is still a lot of room for improvement on the F1-scores, especially for the emotion classes that are less present in the dataset. To the best of our knowledge, the results presented by our transformer-based joint-encoding are the strongest scores for the sentiment task on the dataset.\n\nThe following list identifies other features we computed as input for our model that lead to weaker performances:\n\n• We tried the OpenFace 2.0 features  (Baltrusaitis et al., 2018) . This strategy computes facial landmark, the features are specialized for facial behavior analysis;\n\n• We tried a simple 2D CNN named DenseNet  (Huang et al., 2017) . For each frame of the video, a feature vector is extracted by taking the output of the average pooling layer;\n\n• We tried different values for the number of mel filter bank (512 and 1024) and temporal reduction (1, 2, 4 and 8 frames), we also tried to use the full spectrogram;\n\n• We tried not using the GloVe embedding.",
      "page_start": 7,
      "page_end": 7
    }
  ],
  "figures": [
    {
      "caption": "Figure 1: Monomodal Transformer encoder.",
      "page": 2
    },
    {
      "caption": "Figure 2: Multimodal Transformer Encoder for two",
      "page": 3
    },
    {
      "caption": "Figure 2: depicts the encoding for two",
      "page": 3
    },
    {
      "caption": "Figure 3: MOSEI statistics, taken from the author’s pa-",
      "page": 5
    },
    {
      "caption": "Figure 3: shows the distribution of sentiment",
      "page": 5
    },
    {
      "caption": "Figure 4: Temporal dimension (i.e. rows in our feature",
      "page": 5
    },
    {
      "caption": "Figure 5: 7-class sentiment accuracy according to the",
      "page": 6
    }
  ],
  "tables": [
    {
      "caption": "Table 1: Results on the test-set. Note that the F1-scores for emotions are weighted to be consistent with the previous",
      "page": 5
    },
    {
      "caption": "Table 1: show the scores of our different",
      "page": 5
    },
    {
      "caption": "Table 2: depicts the results of our",
      "page": 6
    },
    {
      "caption": "Table 2: Results on the private test-fold for 7-class sen-",
      "page": 6
    }
  ],
  "citations": [
    {
      "citation_id": "1",
      "title": "Layer normalization",
      "authors": [
        "Jimmy Lei Ba",
        "Jamie Ryan Kiros",
        "Geoffrey Hinton"
      ],
      "year": "2016",
      "venue": "Layer normalization",
      "arxiv": "arXiv:1607.06450"
    },
    {
      "citation_id": "2",
      "title": "Openface 2.0: Facial behavior analysis toolkit",
      "authors": [
        "Tadas Baltrusaitis",
        "Amir Zadeh",
        "Chong Lim",
        "Louis-Philippe Morency"
      ],
      "year": "2018",
      "venue": "13th IEEE International Conference on Automatic Face & Gesture Recognition"
    },
    {
      "citation_id": "3",
      "title": "Densely connected convolutional networks",
      "authors": [
        "Gao Huang",
        "Zhuang Liu",
        "Laurens Van Der Maaten",
        "Kilian Weinberger"
      ],
      "year": "2017",
      "venue": "Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition"
    },
    {
      "citation_id": "4",
      "title": "Adam: A method for stochastic optimization",
      "authors": [
        "P Diederik",
        "Jimmy Kingma",
        "Ba"
      ],
      "year": "2014",
      "venue": "Adam: A method for stochastic optimization",
      "arxiv": "arXiv:1412.6980"
    },
    {
      "citation_id": "5",
      "title": "Eric Battenberg, and Oriol Nieto. 2015. librosa: Audio and music signal analysis in python",
      "authors": [
        "Brian Mcfee",
        "Colin Raffel",
        "Dawen Liang",
        "P Daniel",
        "Matt Ellis",
        "Mcvicar"
      ],
      "venue": "Proceedings of the 14th python in science conference"
    },
    {
      "citation_id": "6",
      "title": "Glove: Global vectors for word representation",
      "authors": [
        "Jeffrey Pennington",
        "Richard Socher",
        "Christopher Manning"
      ],
      "year": "2014",
      "venue": "EMNLP"
    },
    {
      "citation_id": "7",
      "title": "Multimodal relational tensor network for sentiment and emotion classification",
      "authors": [
        "Saurav Sahay",
        "H Shachi",
        "Rui Kumar",
        "Jonathan Xia",
        "Lama Huang",
        "Nachman"
      ],
      "year": "2018",
      "venue": "Proceedings of Grand Challenge and Workshop on Human Multimodal Language (Challenge-HML)",
      "doi": "10.18653/v1/W18-3303"
    },
    {
      "citation_id": "8",
      "title": "Multiloguenet: A context aware rnn for multi-modal emotion detection and sentiment analysis in conversation",
      "authors": [
        "Aman Shenoy",
        "Ashish Sardana"
      ],
      "year": "2020",
      "venue": "Multiloguenet: A context aware rnn for multi-modal emotion detection and sentiment analysis in conversation"
    },
    {
      "citation_id": "9",
      "title": "Efficiently trainable text-tospeech system based on deep convolutional networks with guided attention",
      "authors": [
        "Hideyuki Tachibana",
        "Katsuya Uenoyama",
        "Shunsuke Aihara"
      ],
      "year": "2018",
      "venue": "2018 IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP)"
    },
    {
      "citation_id": "10",
      "title": "Learning spatiotemporal features with 3d convolutional networks",
      "authors": [
        "Du Tran",
        "Lubomir Bourdev",
        "Rob Fergus",
        "Lorenzo Torresani",
        "Manohar Paluri"
      ],
      "year": "2015",
      "venue": "Proceedings of the IEEE International Conference on Computer Vision"
    },
    {
      "citation_id": "11",
      "title": "A closer look at spatiotemporal convolutions for action recognition",
      "authors": [
        "Du Tran",
        "Heng Wang",
        "Lorenzo Torresani",
        "Jamie Ray",
        "Yann Lecun",
        "Manohar Paluri"
      ],
      "year": "2018",
      "venue": "Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR)"
    },
    {
      "citation_id": "12",
      "title": "Attention is all you need",
      "authors": [
        "Ashish Vaswani",
        "Noam Shazeer",
        "Niki Parmar",
        "Jakob Uszkoreit",
        "Llion Jones",
        "Aidan Gomez",
        "Łukasz Kaiser",
        "Illia Polosukhin"
      ],
      "year": "2017",
      "venue": "Advances in neural information processing systems"
    },
    {
      "citation_id": "13",
      "title": "Deep modular co-attention networks for visual question answering",
      "authors": [
        "Zhou Yu",
        "Jun Yu",
        "Yuhao Cui",
        "Dacheng Tao",
        "Qi Tian"
      ],
      "year": "2019",
      "venue": "Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition"
    },
    {
      "citation_id": "14",
      "title": "Soujanya Poria, Erik Cambria, and Louis-Philippe Morency. 2018a. Memory fusion network for multiview sequential learning",
      "authors": [
        "Amir Zadeh",
        "Paul Liang",
        "Navonil Mazumder"
      ],
      "venue": "Thirty-Second AAAI Conference on Artificial Intelligence"
    },
    {
      "citation_id": "15",
      "title": "Multimodal language analysis in the wild: CMU-MOSEI dataset and interpretable dynamic fusion graph",
      "authors": [
        "Amirali Zadeh",
        "Paul Liang",
        "Soujanya Poria",
        "Erik Cambria",
        "Louis-Philippe Morency"
      ],
      "year": "2018",
      "venue": "Proceedings of the 56th Annual Meeting of the Association for Computational Linguistics",
      "doi": "10.18653/v1/P18-1208"
    }
  ]
}